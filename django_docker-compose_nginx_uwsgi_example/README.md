# Django + Docker Compose + Nginx + uWSGI  
This project is demonstrating the use of the following technologies for a production level Django project in order to make it secure, scalable, and durable:  
1. Django: Django is a Pythong based web framework for the development of web applications. It is quite suitable to develop heavy web applications and it has been used by a number of big companies for their products.   
2. Docker (or Docker Compose): It helps to containerize our applications so that we don't have to struggle with installation and version compatibility issues while porting and deploying our applications from the development machine to the server. Apart from this, it also makes applications secure due to their sandboxing.  
3. Nginx: Nginx is reverse-proxy web server. It is quite popular among big companies as it is quite safe, scalable, and fast (perfect for production level applications).  
4. uWSGI: Since web servers don't understand Python, thus uWSGI (Web Server Gateway Interface) helps them to server Python applications.  
  
## Platform & Technologies  
Following are the details of the platform and technologies used in this project:  
1. OS: Ubuntu 20.04  
2. Programming Language: Python 3.8  
3. Web Server: Nginx ("unprivileged" official docker image)  
4. Web Framework: Django 4.0.8  
5. WSGI: uWSGI 2.0.21  
6. Docker  
  
## Development Steps  
Following are the steps to develop and run this project on local machine:  
1. Assume `django_docker-compose_nginx_uwsgi_example` is the directory in which you want to develop this entire project. Navigate to this directory in your terminal.  
2. There, start a django project with name `app` (i.e., django_docker-compose_nginx_uwsgi_example/app) by firing the following commands:  
	```
	$ django-admin startproject app
	$ python manage.py startapp _____
	```  
3. Develop your django project, test it on the Django's debug server. On successful development and testing, ensure that the file `django_docker-compose_nginx_uwsgi_example/app/app/settings.py` is like the below one:  
```
"""
Django settings for app project.

Generated by 'django-admin startproject' using Django 4.0.8.

For more information on this file, see
https://docs.djangoproject.com/en/4.0/topics/settings/

For the full list of settings and their values, see
https://docs.djangoproject.com/en/4.0/ref/settings/
"""

from pathlib import Path
import os

# Build paths inside the project like this: BASE_DIR / 'subdir'.
BASE_DIR = Path(__file__).resolve().parent.parent


# Quick-start development settings - unsuitable for production
# See https://docs.djangoproject.com/en/4.0/howto/deployment/checklist/

# SECURITY WARNING: keep the secret key used in production secret!
SECRET_KEY = 'django-insecure-wgq$*!y%bk0_z2%inq8&)@46!m-*(f&8y7ttc87avj&qm^&i@m'

# SECURITY WARNING: don't run with debug turned on in production!
DEBUG = bool(int(os.environ.get('DEBUG', 0)))

ALLOWED_HOSTS = []
ALLOWED_HOSTS_ENV = os.environ.get('ALLOWED_HOSTS')
if ALLOWED_HOSTS_ENV:
    ALLOWED_HOSTS.extend(ALLOWED_HOSTS_ENV.split(','))

# Application definition

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'homeapp',
]

MIDDLEWARE = [
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

ROOT_URLCONF = 'app.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'app.wsgi.application'


# Database
# https://docs.djangoproject.com/en/4.0/ref/settings/#databases

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.sqlite3',
        'NAME': BASE_DIR / 'db.sqlite3',
    }
}


# Password validation
# https://docs.djangoproject.com/en/4.0/ref/settings/#auth-password-validators

AUTH_PASSWORD_VALIDATORS = [
    {
        'NAME': 'django.contrib.auth.password_validation.UserAttributeSimilarityValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.MinimumLengthValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.CommonPasswordValidator',
    },
    {
        'NAME': 'django.contrib.auth.password_validation.NumericPasswordValidator',
    },
]


# Internationalization
# https://docs.djangoproject.com/en/4.0/topics/i18n/

LANGUAGE_CODE = 'en-us'

TIME_ZONE = 'UTC'

USE_I18N = True

USE_TZ = True


# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/4.0/howto/static-files/

#STATIC_URL = 'static/'
STATIC_URL = '/static/static/'
MEDIA_URL = '/static/media/'

STATIC_ROOT = '/vol/web/static'
MEDIA_ROOT = '/vol/web/media'

# Default primary key field type
# https://docs.djangoproject.com/en/4.0/ref/settings/#default-auto-field

DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'

```  
4. Now, run the following commands: `$ mkdir django_docker-compose_nginx_uwsgi_example/proxy`  
5. Now, create a file `django_docker-compose_nginx_uwsgi_example/proxy/default.conf` and paste the following content in it (NO EDITS REQUIRED):  
```
server {
    listen 8080;

    location /static {
        alias /vol/static;
    }

    location / {
        uwsgi_pass app:8000;
        include /etc/nginx/uwsgi_params;
    }
}

```  
6. Create `django_docker-compose_nginx_uwsgi_example/proxy/Dockerfile` and paste the following content (NO EDITS REQUIRED):  
```
FROM nginxinc/nginx-unprivileged:1-alpine

COPY ./default.conf /etc/nginx/conf.d/default.conf
COPY ./uwsgi_params /etc/nginx/uwsgi_params

USER root

RUN mkdir -p /vol/static
RUN chmod 755 /vol/static

USER nginx
```  
7. Create `django_docker-compose_nginx_uwsgi_example/proxy/uwsgi_params` file and paste the following content (NO EDITS REQUIRED):  
```
uwsgi_param QUERY_STRING $query_string;
uwsgi_param REQUEST_METHOD $request_method;
uwsgi_param CONTENT_TYPE $content_type;
uwsgi_param CONTENT_LENGTH $content_length;
uwsgi_param REQUEST_URI $request_uri;
uwsgi_param PATH_INFO $document_uri;
uwsgi_param DOCUMENT_ROOT $document_root;
uwsgi_param SERVER_PROTOCOL $server_protocol;
uwsgi_param REMOTE_ADDR $remote_addr;
uwsgi_param REMOTE_PORT $remote_port;
uwsgi_param SERVER_ADDR $server_addr;
uwsgi_param SERVER_PORT $server_port;
uwsgi_param SERVER_NAME $server_name;
```  
8. Create another directory `django_docker-compose_nginx_uwsgi_example/scripts`.  
9. Now, create the file `django_docker-compose_nginx_uwsgi_example/scripts/entrypoint.sh` and paste the following content in it (NO EDITS REQUIRED):  
```
#!/bin/sh

set -e

python manage.py collectstatic --noinput

uwsgi --socket :8000 --master --enable-threads --module app.wsgi
```  
10. Now, create a file `django_docker-compose_nginx_uwsgi_example/docker-compose.yml` and paste the following content (NO EDITS REQUIRED):  
```
version: '3.7'

services:
  app:
    build:
      context: .
    volumes:
      - static_data:/vol/web
    environment:
      - SECRET_KEY=samplesecret123
      - ALLOWED_HOSTS=127.0.0.1,localhost

  proxy:
    build:
      context: ./proxy
    volumes:
      - static_data:/vol/static
    ports:
      - "8080:8080"
    depends_on:
      - app

volumes:
  static_data:
```  
11. Now, create `django_docker-compose_nginx_uwsgi_example/Dockerfile` and paste the following content in it (NO EDITS REQUIRED):  
```
FROM python:3.8-alpine

ENV PATH="/scripts:${PATH}"

COPY ./requirements.txt /requirements.txt
RUN apk add --update --no-cache --virtual .tmp gcc libc-dev linux-headers
RUN pip install -r /requirements.txt
RUN apk del .tmp

RUN mkdir /app
COPY ./app /app
WORKDIR /app
COPY ./scripts /scripts

RUN chmod +x /scripts/*

RUN mkdir -p /vol/web/media
RUN mkdir -p /vol/web/static
RUN adduser -D user
RUN chown -R user:user /vol
RUN chmod -R 755 /vol/web
USER user

CMD ["entrypoint.sh"]
```  
12. Next, create a file `django_docker-compose_nginx_uwsgi_example/requirements.txt` and paste the following content in it (IT MAY REQUIRE EDITS):  
```
Django==4.0.8
uWSGI==2.0.21
```  
13. Finally, everything is done. Now, run the following command in terminal (make sure, you are in the directory `django_docker-compose_nginx_uwsgi_example`):  
`$ docker-compose build`  
14. Once the build completes successfully completely, run the following command:  
`$ docker-compose up`  